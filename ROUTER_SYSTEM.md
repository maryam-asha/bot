# ูุธุงู Router ูุน Handlers ูููุตูุฉ

## ๐ฏ ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅุนุงุฏุฉ ููููุฉ ุงูุจูุช ุจุงุณุชุฎุฏุงู ูุธุงู Router ูุชูุฌูู ุงูุฑุณุงุฆู ุฅูู handlers ูููุตูุฉุ ููุง ูุฌุนู ุงูููุฏ ุฃูุซุฑ ุชูุธููุงู ููุงุจููุฉ ููุตูุงูุฉ.

## ๐๏ธ ูููู ุงููุธุงู

### 1. **MessageRouter** - ุงูููุฌู ุงูุฑุฆูุณู
```python
class MessageRouter:
    """Router ูุชูุฌูู ุงูุฑุณุงุฆู ูููุงูุฏูุฑ ุงูุตุญูุญ"""
```

**ุงููุณุคูููุงุช:**
- ุชูุฌูู ุงูุฑุณุงุฆู ุฅูู ุงููุนุงูุฌ ุงูููุงุณุจ ุจูุงุกู ุนูู ุญุงูุฉ ุงููุญุงุฏุซุฉ
- ูุนุงูุฌุฉ ุงูุฃูุงูุฑ ุงูุฎุงุตุฉ (/start, /cancel, /help)
- ูุนุงูุฌุฉ ุฃููุงุน ูุฎุชููุฉ ูู ุงูุฑุณุงุฆู (ูุตุ ูููุนุ ูููุงุชุ ุตูุฑุ ุตูุช)

### 2. **Handlers ูููุตูุฉ**

#### **MainMenuHandler**
- ูุนุงูุฌุฉ ุงููุงุฆูุฉ ุงูุฑุฆูุณูุฉ
- ุนุฑุถ ุงููุนูููุงุช ุงูุนุงูุฉ (ุญูู ุงูููุตุฉุ ุงููุฒุงุฑุฉุ ุงูุดุฑูุฉ)
- ุชูุฌูู ุงููุณุชุฎุฏู ููุฎุฏูุงุช

#### **AuthHandler**
- ูุนุงูุฌุฉ ุนูููุงุช ุงููุตุงุฏูุฉ
- ุฅุฏุฎุงู ุฑูู ุงููุงุชู
- ุงูุชุญูู ูู ุฑูุฒ OTP
- ุฅุฏุงุฑุฉ ุญุงูุฉ ุชุณุฌูู ุงูุฏุฎูู

#### **ServiceMenuHandler**
- ูุนุงูุฌุฉ ูุงุฆูุฉ ุงูุฎุฏูุงุช
- ุนุฑุถ ุทูุจุงุช ุงููุณุชุฎุฏู ุงูุณุงุจูุฉ
- ุชูุฌูู ุงููุณุชุฎุฏู ูุฅูุดุงุก ุทูุจ ุฌุฏูุฏ

#### **RequestHandler**
- ูุนุงูุฌุฉ ุงุฎุชูุงุฑ ููุน ุงูุทูุจ
- ุงุฎุชูุงุฑ ุงูุฌุงูุจ ูุงูููุถูุน
- ุชุญููู ุงููููุฐุฌ ุงูููุงุณุจ

#### **FormHandler**
- ูุนุงูุฌุฉ ุชุนุจุฆุฉ ุงูููุงุฐุฌ
- ุงูุชุญูู ูู ุตุญุฉ ุงููุฏุฎูุงุช
- ุฑูุน ุงููููุงุช ูุงูุตูุฑ
- ุฅุฑุณุงู ุงููููุฐุฌ ุงูููุงุฆู

## ๐ ุชุฏูู ุงูุนูู

```
MessageRouter
    โ
ุชุญุฏูุฏ ุญุงูุฉ ุงููุญุงุฏุซุฉ
    โ
ุชูุฌูู ุงูุฑุณุงูุฉ ููู Handler ุงูููุงุณุจ
    โ
ูุนุงูุฌุฉ ุงูุฑุณุงูุฉ
    โ
ุฅุฑุฌุงุน ุญุงูุฉ ุฌุฏูุฏุฉ
    โ
ุชุญุฏูุซ ุญุงูุฉ ุงููุญุงุฏุซุฉ
```

## ๐ Mapping ุงูุญุงูุงุช

| ุงูุญุงูุฉ | Handler | ุงููุตู |
|--------|---------|-------|
| `MAIN_MENU` | `MainMenuHandler` | ุงููุงุฆูุฉ ุงูุฑุฆูุณูุฉ |
| `SERVICE_MENU` | `ServiceMenuHandler` | ูุงุฆูุฉ ุงูุฎุฏูุงุช |
| `ENTER_MOBILE` | `AuthHandler` | ุฅุฏุฎุงู ุฑูู ุงููุงุชู |
| `ENTER_OTP` | `AuthHandler` | ุงูุชุญูู ูู OTP |
| `SELECT_REQUEST_TYPE` | `RequestHandler` | ุงุฎุชูุงุฑ ููุน ุงูุทูุจ |
| `SELECT_COMPLIMENT_SIDE` | `RequestHandler` | ุงุฎุชูุงุฑ ุงูุฌุงูุจ |
| `SELECT_SUBJECT` | `RequestHandler` | ุงุฎุชูุงุฑ ุงูููุถูุน |
| `FILL_FORM` | `FormHandler` | ุชุนุจุฆุฉ ุงููููุฐุฌ |
| `CONFIRM_SUBMISSION` | `FormHandler` | ุชุฃููุฏ ุงูุฅุฑุณุงู |

## ๐ ุงููุฒุงูุง

### 1. **ุชูุธูู ุฃูุถู**
- ูู handler ูุณุคูู ุนู ุฌุฒุก ูุญุฏุฏ ูู ุงููุธุงุฆู
- ุณูููุฉ ุงูุตูุงูุฉ ูุงูุชุทููุฑ
- ูุตู ูุงุถุญ ูููุณุคูููุงุช

### 2. **ูุงุจููุฉ ุงูุชูุณุน**
- ุฅุถุงูุฉ handlers ุฌุฏูุฏุฉ ุจุณูููุฉ
- ุชุนุฏูู handler ูุงุญุฏ ุฏูู ุงูุชุฃุซูุฑ ุนูู ุงูุขุฎุฑูู
- ุฅุนุงุฏุฉ ุงุณุชุฎุฏุงู ุงูููุฏ

### 3. **ุฃุฏุงุก ูุญุณู**
- ูุฑุงูุจุฉ ุงูุฃุฏุงุก ููู handler ูููุตูุฉ
- ุชุญุณูู ูุญุฏูุฏ ููู ุฌุฒุก
- ุชุญููู ุฏููุงูููู ููู handlers

### 4. **ุงุฎุชุจุงุฑ ุฃุณูู**
- ุงุฎุชุจุงุฑ ูู handler ุจุดูู ูููุตู
- ุงุฎุชุจุงุฑุงุช ูุญุฏุฉ ุฃูุซุฑ ุฏูุฉ
- ุชุบุทูุฉ ุงุฎุชุจุงุฑ ุฃูุถู

## ๐ง ุงูุงุณุชุฎุฏุงู

### ุชุดุบูู ุงูุจูุช
```bash
python3 bot_with_router.py
```

### ุฅุถุงูุฉ Handler ุฌุฏูุฏ
```python
# ุฅูุดุงุก handler ุฌุฏูุฏ
class NewHandler(BaseHandler):
    async def process(self, update, context):
        # ูุนุงูุฌุฉ ุงูุฑุณุงูุฉ
        pass

# ุฅุถุงูุฉ ููู router
self.state_handlers[ConversationState.NEW_STATE] = NewHandler(self.api_service)
```

### ุชุนุฏูู Handler ููุฌูุฏ
```python
# ุชุนุฏูู ูุจุงุดุฑ ูู ููู Handler ุงูููุงุณุจ
class MainMenuHandler(BaseHandler):
    async def process(self, update, context):
        # ุงูุชุนุฏููุงุช ุงููุทููุจุฉ
        pass
```

## ๐ ุฃูุซูุฉ ุนูู ุงูุงุณุชุฎุฏุงู

### 1. ูุนุงูุฌุฉ ุฑุณุงูุฉ ูุตูุฉ
```python
# ูู MessageRouter
async def route_message(self, update, context):
    current_state = context.user_data.get('current_state')
    handler = self.state_handlers.get(current_state)
    return await handler.process(update, context)
```

### 2. ูุนุงูุฌุฉ ูููุน
```python
async def handle_location(self, update, context):
    current_state = context.user_data.get('current_state')
    
    if current_state == ConversationState.FILL_FORM:
        return await self.form_handler._handle_location_input(update, context)
    else:
        # ุญูุธ ุงููููุน ููุงุณุชุฎุฏุงู ูุงุญูุงู
        pass
```

### 3. ูุนุงูุฌุฉ ููู
```python
async def handle_document(self, update, context):
    current_state = context.user_data.get('current_state')
    
    if current_state == ConversationState.FILL_FORM:
        return await self.form_handler._handle_document_input(update, context)
    else:
        # ุฑุณุงูุฉ ุฎุทุฃ
        pass
```

## ๐ฏ ุฃูุถู ุงูููุงุฑุณุงุช

### 1. **ุชุตููู ุงูู Handlers**
- ูู handler ูุณุคูู ุนู ูุธููุฉ ูุงุญุฏุฉ
- ุงุณุชุฎุฏุงู ุงููุฑุงุซุฉ ูู BaseHandler
- ุฅุถุงูุฉ ูุฑุงูุจุฉ ุงูุฃุฏุงุก ููู handler

### 2. **ุฅุฏุงุฑุฉ ุงูุญุงูุฉ**
- ุชุญุฏูุซ ุญุงูุฉ ุงููุญุงุฏุซุฉ ูู context
- ุงูุชุญูู ูู ุตุญุฉ ุงูุญุงูุฉ ูุจู ุงููุนุงูุฌุฉ
- ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุจุดูู ููุงุณุจ

### 3. **ุงูุฃุฏุงุก**
- ุงุณุชุฎุฏุงู ุงูุชุฎุฒูู ุงููุคูุช ููุจูุงูุงุช ุงููุชูุฑุฑุฉ
- ุชุญุณูู ุงุณุชุนูุงูุงุช API
- ูุฑุงูุจุฉ ุงูุฃุฏุงุก ุจุงุณุชูุฑุงุฑ

### 4. **ุงูุฃูุงู**
- ุงูุชุญูู ูู ุงููุตุงุฏูุฉ ูุจู ุงูุนูููุงุช ุงูุญุณุงุณุฉ
- ุงูุชุญูู ูู ุตุญุฉ ุงููุฏุฎูุงุช
- ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุจุดูู ุขูู

## ๐ ูุฑุงูุจุฉ ุงูุฃุฏุงุก

### ุฅุญุตุงุฆูุงุช ุงูุฃุฏุงุก
```python
# ุงูุญุตูู ุนูู ุฅุญุตุงุฆูุงุช ุงูุฃุฏุงุก
stats = await bot.get_performance_stats()
print(stats['performance'])
print(stats['cache'])
```

### ูุฑุงูุจุฉ ุงูู Handlers
```python
@monitor_async_performance
async def process(self, update, context):
    # ูุนุงูุฌุฉ ุงูุฑุณุงูุฉ ูุน ูุฑุงูุจุฉ ุงูุฃุฏุงุก
    pass
```

## ๐จ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก

### ุฃุฎุทุงุก ุดุงุฆุนุฉ
1. **Handler ุบูุฑ ููุฌูุฏ**
   - ุฅุฑุฌุงุน ูููุงุฆูุฉ ุงูุฑุฆูุณูุฉ
   - ุชุณุฌูู ุงูุฎุทุฃ ูููุญุต

2. **ุฎุทุฃ ูู API**
   - ุฅุนุงุฏุฉ ุงููุญุงููุฉ
   - ุฑุณุงูุฉ ุฎุทุฃ ููุงุณุจุฉ ูููุณุชุฎุฏู

3. **ุญุงูุฉ ุบูุฑ ุตุญูุญุฉ**
   - ุฅุนุงุฏุฉ ุชุนููู ุงูุญุงูุฉ
   - ุชูุฌูู ูููุณุชุฎุฏู ููุจุฏุก ูู ุฌุฏูุฏ

## ๐ ุงูุชุญุณููุงุช ุงููุณุชูุจููุฉ

1. **Middleware System**
   - ูุนุงูุฌุฉ ูุดุชุฑูุฉ ูุจู ูุจุนุฏ ุงูู handlers
   - ุชุณุฌูู ุงูุฃุญุฏุงุซ
   - ุงูุชุญูู ูู ุงูุตูุงุญูุงุช

2. **Plugin System**
   - ุฅุถุงูุฉ ูุธุงุฆู ุฌุฏูุฏุฉ ุจุณูููุฉ
   - ุชุญููู ุฏููุงูููู ููู plugins
   - ุฅุฏุงุฑุฉ ุงูุชุจุนูุงุช

3. **Advanced Caching**
   - ุชุฎุฒูู ูุคูุช ุฐูู
   - ุฅุฏุงุฑุฉ ุงูุฐุงูุฑุฉ
   - ุชุญุณูู ุงูุฃุฏุงุก

---

*ุงููุธุงู ุงูุฌุฏูุฏ ูููุฑ ุชูุธููุงู ุฃูุถู ูุฃุฏุงุก ูุญุณูุงู ููุงุจููุฉ ููุชูุณุน*